var MAX_COLOUR=255;var MIN_COLOUR=0;var zIndex=1000;var heatmap=null;var drawing=new function(){this.setupCanvas=function(){var docWidth=jQuery(document).width();var docHeight=jQuery(document).height();var canvasContainer=document.createElement('div');document.body.appendChild(canvasContainer);canvasContainer.setAttribute("id","canvasContainer");canvasContainer.style.left="0px";canvasContainer.style.top="0px";canvasContainer.style.zIndex=zIndex;if(isHeatmap){canvasContainer.style.width=docWidth+"px";canvasContainer.style.height=docHeight+"px";canvasContainer.style.position="absolute";var config={element:document.getElementById("canvasContainer"),radius:spotRadius,opacity:opacity*100};heatmap=h337.create(config);heatmap.store.setDataSet({max:hot,data:[]})}else{canvasContainer.style.position="absolute";canvasContainer.style.width="100%";canvasContainer.style.height="100%";var canvas=document.createElement("canvas");canvas.setAttribute("id","canvas");canvas.style.width=docWidth;canvas.style.height=docHeight;canvas.width=docWidth;canvas.height=docHeight;canvas.style.overflow='visible';canvas.style.position='absolute';canvasContainer.appendChild(canvas)}
jQuery("body *").each(function(){var opacity=jQuery(this).css("opacity");if(opacity!==undefined&&opacity===1){jQuery(this).css({opacity:0.99})}
var tempZIndex=jQuery(this).css("z-index");if(tempZIndex!="auto"&&parseInt(tempZIndex)>parseInt(zIndex)){zIndex=parseInt(tempZIndex)+1;var canvasContainer=jQuery("#canvasContainer");canvasContainer.css("z-index",zIndex)}})};this.init=function(isHeatmap){jQuery('#wpadminbar').remove();var css='html { margin-top: 0px !important; } * html body { margin-top: 0px !important; }';var head=document.head||document.getElementsByTagName('head')[0];style=document.createElement('style');style.type='text/css';if(style.styleSheet){style.styleSheet.cssText=css}else{style.appendChild(document.createTextNode(css))}
head.appendChild(style);this.setupCanvas()};this.drawArc=function(xCoord,yCoord,heatValue){var canvas=jQuery("#canvas").get(0);var context=canvas.getContext("2d");context.beginPath();context.arc(xCoord,yCoord,spotRadius,0,2*Math.PI);var fillStyle=null;if(heatValue===0){fillStyle="rgba("+MIN_COLOUR+", "+MAX_COLOUR+", "+MIN_COLOUR+", "+opacity+")"}else if(heatValue===warm){fillStyle="rgba("+MAX_COLOUR+", "+MAX_COLOUR+", "+MIN_COLOUR+", "+opacity+")"}else if(heatValue>=hot){fillStyle="rgba("+MAX_COLOUR+", "+MIN_COLOUR+", "+MIN_COLOUR+", "+opacity+")"}else{if(heatValue>warm){var someGreen=MAX_COLOUR-(MAX_COLOUR*((heatValue-warm)/warm));fillStyle="rgba("+MAX_COLOUR+", "+Math.round(someGreen)+", "+MIN_COLOUR+", "+opacity+")"}else{var someRed=MAX_COLOUR*(heatValue/warm);fillStyle="rgba("+Math.round(someRed)+", "+MAX_COLOUR+", "+MIN_COLOUR+", "+opacity+")"}}
context.fillStyle=fillStyle;context.fill()};this.doDrawing=function(events){for(var index in events){var eventData=events[index];if(eventData.event_type=="mouse_click"||eventData.event_type=="touchscreen_tap"){if(isHeatmap){heatmap.store.addDataPoint(eventData.x_coord,eventData.y_coord,1)}else{this.drawArc(eventData.x_coord,eventData.y_coord,eventData.heat_value)}}}};this.drawHeatmap=function(){utils.showLoadingDialog(!1);var url=window.location.href;var hashIndex=url.indexOf('#');if(hashIndex>0){url=url.substring(0,hashIndex)}
var userEventId=utils.getUrlParamByName(url,"userEventId");var device=utils.getUrlParamByName(url,"device");var browser=utils.getUrlParamByName(url,"browser");var os=utils.getUrlParamByName(url,"os");var data={action:"retrieve_user_events",nonce:config_data.ajax_nonce,pluginVersion:config_data.plugin_version,url:url,pageWidth:utils.getPageWidth(),userEventId:(userEventId!==undefined&&userEventId!=="")?userEventId:null,device:(device!==undefined&&device!=="")?device:null,os:(os!==undefined&&os!=="")?os:null,browser:(browser!==undefined&&browser!=="")?browser:null,userId:config_data.user_id,userEnvironmentId:config_data.user_environment_id,eventTypes:["mouse_click","touchscreen_tap"],ipAddress:config_data.ip_address,sessionId:config_data.session_id,debug:debug,drawHeatMapEnabled:drawHeatmapEnabled,spotRadius:spotRadius,ignoreWidth:config_data.ignore_width,widthAllowance:config_data.width_allowance,ignoreDevice:config_data.ignore_device,ignoreOs:config_data.ignore_os,ignoreBrowser:config_data.ignore_browser,hideRoles:config_data.hide_roles,};jQuery.get(config_data.ajax_url,data,function(response){var events=jQuery.parseJSON(response);drawing.doDrawing(events);utils.closeLoadingDialog()})};this.destroy=function(){jQuery("#canvasContainer").remove()};this.setupInfoPanel=function(refresh){jQuery("<div id='infoPanel'>"+"Page Width: <div id='infoPageWidth' style='display: inline-block' />px, "+"Browser: <div id='infoBrowser' style='display: inline-block'/>, "+"OS: <div id='infoOS' style='display: inline-block'/>, "+"Device: <div id='infoDevice' style='display: inline-block'/>. "+"<a href='#' id='infoCloseLink'>Close</a> | "+"<a href='#' id='infoClearLink'>Clear</a>"+"</div>").appendTo("body");jQuery("#infoCloseLink").on("click",function(){jQuery("#infoPanel").remove()});jQuery("#infoClearLink").on("click",function(){jQuery("#infoPanel").remove();jQuery("#canvasContainer").remove();drawHeatmapEnabled=!1});if(refresh){this.refreshInfoPanel()}
jQuery("#infoPanel").css("z-index",zIndex+1);jQuery("#infoPanel *").css("z-index",zIndex+1);var url=window.location.href;var widthQueryParam=utils.getUrlParamByName(url,"pageWidth");var pageWidth=utils.getPageWidth();var osQueryParam=utils.getUrlParamByName(url,"os");var browserQueryParam=utils.getUrlParamByName(url,"browser");var deviceQueryParam=utils.getUrlParamByName(url,"device");var message="";if(widthQueryParam!==undefined&&widthQueryParam!==""&&pageWidth!=widthQueryParam){message+="Target page width is "+widthQueryParam+"px. "}
if(osQueryParam!==undefined&&osQueryParam!==""&&config_data.os!=osQueryParam){message+="Target operating system is "+osQueryParam+". "}
if(browserQueryParam!==undefined&&browserQueryParam!==""&&config_data.browser!=browserQueryParam){message+="Target browser is "+browserQueryParam+". "}
if(deviceQueryParam!==undefined&&deviceQueryParam!==""&&config_data.device!=deviceQueryParam){message+="Target device is "+deviceQueryParam+"."}
if(message.length>0)
message="<p style='color: Orange;'>"+message+"</p>";jQuery(message).appendTo("#infoPanel")};this.refreshInfoPanel=function(){var pageWidth=utils.getPageWidth();jQuery("#infoPageWidth").html(pageWidth);jQuery("#infoBrowser").html(config_data.browser);jQuery("#infoOS").html(config_data.os);jQuery("#infoDevice").html(config_data.device)}}